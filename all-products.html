<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Products - Okinawa</title>
    
    <!-- TailwindCSS v3.4.10 CDN -->
    <script src="https://cdn.tailwindcss.com?v=3.4.10"></script>
    
    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#A61f23',
                        primaryDark: '#8a1a1f',
                        accent: '#cf2029'
                    }
                }
            }
        }
    </script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/custom.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-white">

    <!-- Header -->
    <header class="fixed w-full top-0 z-50 bg-white/90 backdrop-blur-lg shadow-lg border-b border-gray-100">
        <nav class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <a href="index.html" class="flex items-center">
                    <img src="oki.png" alt="Okinawa" class="h-12 w-auto object-contain hover:opacity-80 transition-opacity">
                </a>

                <!-- Navigation & Buttons -->
                <div class="flex items-center gap-4">
                    <!-- Cart Button -->
                    <button onclick="openCart()" class="relative p-2 text-gray-700 hover:text-primary transition-colors">
                        <i class="fas fa-shopping-cart text-2xl"></i>
                        <span id="cart-count" class="absolute -top-1 -right-1 bg-primary text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">0</span>
                </button>
                
                    <!-- Language Toggle -->
                    <button onclick="toggleLanguage()" class="hidden md:flex items-center gap-2 px-4 py-2 bg-gray-800 text-white rounded-full hover:bg-gray-700 transition-colors font-medium">
                    <span class="lang-text">EN</span>
                        <i class="fas fa-globe"></i>
                </button>
                
                    <!-- Auth Buttons (When Logged Out) -->
                    <div id="auth-buttons" class="md:flex items-center gap-2">
                        <a href="index.html#login" class="px-4 py-2 text-primary hover:text-primaryDark transition-colors font-medium">Login</a>
                        <a href="index.html#register" class="px-6 py-2 bg-primary text-white rounded-full hover:bg-primaryDark transition-colors font-medium shadow-lg">Register</a>
                    </div>

                    <!-- User Info (When Logged In) -->
                    <div id="user-info" class="hidden items-center gap-4">
                        <a href="profile.html" class="flex items-center gap-2 text-gray-700 hover:text-primary transition-colors">
                            <i class="fas fa-user-circle text-2xl"></i>
                            <span id="user-name" class="font-medium">Profile</span>
                        </a>
                        <button onclick="logout()" class="px-4 py-2 border border-primary text-primary hover:bg-primary hover:text-white rounded-full transition-colors font-medium">Logout</button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="pt-24 pb-16 min-h-screen bg-gradient-to-br from-gray-50 to-white">
        <div class="container mx-auto px-4">
            <!-- Page Title -->
            <h1 id="page-title" class="text-4xl md:text-5xl font-bold text-center text-primary mb-8">
                All Products
            </h1>

            <!-- Filters & Search -->
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Search -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Search Products</label>
                        <input 
                            type="text" 
                            id="product-search" 
                            placeholder="Search by name..." 
                            oninput="filterProducts()"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                        >
                    </div>
                    
                    <!-- Category Filter -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Category</label>
                        <select 
                            id="category-filter" 
                            onchange="filterProducts()"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                        >
                                <option value="all">All Categories</option>
                                <optgroup label="Food & Beverage">
                                    <option value="food-beverage">All Food & Beverage</option>
                                    <option value="togarashi-furikake">Togarashi / Furikake</option>
                                    <option value="miso">Miso</option>
                                    <option value="yuzu">Yuzu</option>
                                    <option value="matcha">Matcha</option>
                                </optgroup>
                                <optgroup label="Beauty">
                                    <option value="beauty">All Beauty</option>
                                    <option value="body-soap">Body Soap</option>
                                    <option value="hand-cream">Hand Cream</option>
                                    <option value="face-mask">Face Mask</option>
                                    <option value="facial-tissue">Facial Tissue</option>
                                </optgroup>
                                <optgroup label="Lifestyle">
                                    <option value="lifestyle">All Lifestyle</option>
                                    <option value="chopsticks-holders">Chopsticks & Holders</option>
                                    <option value="matcha-set">Matcha Set</option>
                                    <option value="bag-hanger">Bag Hanger</option>
                                    <option value="rice-soup-spoon">Rice/Soup Spoon</option>
                                    <option value="sushi-set">Sushi Set</option>
                                    <option value="keychain">Keychain</option>
                                    <option value="anime-drawing-book">Anime Drawing Book</option>
                                </optgroup>
                            </select>
                        </div>
                    
                    <!-- Sort By -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sort by</label>
                        <select 
                            id="sort-by" 
                            onchange="filterProducts()"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                        >
                            <option value="name">Name (A-Z)</option>
                            <option value="name-desc">Name (Z-A)</option>
                            <option value="price">Price (Low to High)</option>
                            <option value="price-desc">Price (High to Low)</option>
                            <option value="newest">Newest First</option>
                        </select>
                    </div>
                </div>

                <!-- Product Count -->
                <div id="products-count" class="mt-4 text-gray-600 italic">
                    Loading products...
                </div>
            </div>
            
            <!-- Products Grid -->
            <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Products will be loaded here -->
                <div class="col-span-full text-center py-12">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"></div>
                    <p class="mt-4 text-gray-600">Loading products...</p>
            </div>
        </div>
    </div>
    </main>

    <!-- Mobile FAB -->
    <div class="fixed bottom-6 right-6 flex flex-col gap-3 z-40">
        <!-- Categories Button -->
        <button onclick="toggleCategoryOverlay()" class="w-14 h-14 bg-green-500 text-white rounded-full shadow-lg hover:bg-green-600 transition-all hover:scale-110 flex items-center justify-center">
            <i class="fas fa-th-large text-xl"></i>
        </button>
        
        <!-- Cart Button -->
        <button onclick="openCart()" class="w-14 h-14 bg-primary text-white rounded-full shadow-lg hover:bg-primaryDark transition-all hover:scale-110 flex items-center justify-center relative">
            <i class="fas fa-shopping-cart text-xl"></i>
            <span id="fab-cart-count" class="absolute -top-1 -right-1 bg-accent text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">0</span>
        </button>
    </div>

    <!-- Category Overlay -->
    <div id="category-overlay" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6 animate-slide-up">
            <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-200">
                <h2 class="text-2xl font-bold text-primary">Shop by Category</h2>
                <button onclick="closeCategoryOverlay()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- All Products -->
                <div onclick="selectCategoryAndClose('all-products')" class="group cursor-pointer bg-gradient-to-br from-primary to-accent text-white p-6 rounded-xl hover:shadow-xl transition-all">
                    <div class="text-4xl mb-3">üõçÔ∏è</div>
                    <h3 class="text-lg font-bold">All Products</h3>
                    <p class="text-sm opacity-90">Browse everything</p>
                </div>
                
                <!-- Food & Beverage -->
                <div onclick="selectCategoryAndClose('food-beverage')" class="group cursor-pointer bg-gradient-to-br from-orange-100 to-orange-200 p-6 rounded-xl hover:shadow-xl transition-all hover:-translate-y-1">
                    <div class="text-4xl mb-3">üç±</div>
                    <h3 class="text-lg font-bold text-gray-900">Food & Beverage</h3>
                    <p class="text-sm text-gray-600">Japanese cuisine</p>
                </div>
                
                <!-- Beauty -->
                <div onclick="selectCategoryAndClose('beauty')" class="group cursor-pointer bg-gradient-to-br from-pink-100 to-pink-200 p-6 rounded-xl hover:shadow-xl transition-all hover:-translate-y-1">
                    <div class="text-4xl mb-3">üå∏</div>
                    <h3 class="text-lg font-bold text-gray-900">Beauty</h3>
                    <p class="text-sm text-gray-600">Skincare & wellness</p>
                </div>
                
                <!-- Lifestyle -->
                <div onclick="selectCategoryAndClose('lifestyle')" class="group cursor-pointer bg-gradient-to-br from-green-100 to-green-200 p-6 rounded-xl hover:shadow-xl transition-all hover:-translate-y-1">
                    <div class="text-4xl mb-3">üéã</div>
                    <h3 class="text-lg font-bold text-gray-900">Lifestyle</h3>
                    <p class="text-sm text-gray-600">Home accessories</p>
                        </div>
                        </div>
                    </div>
                </div>
                
    <!-- Cart Sidebar (Reuse from index.html structure) -->
    <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-full md:w-96 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50">
        <div class="flex flex-col h-full">
            <div class="bg-primary text-white p-6 flex justify-between items-center">
                <h2 class="text-2xl font-bold">Shopping Cart</h2>
                <button onclick="closeCart()" class="text-white hover:text-gray-200 transition-colors">
                    <i class="fas fa-times text-2xl"></i>
                </button>
                </div>
                
            <div id="cart-items" class="flex-1 overflow-y-auto p-6">
                <div class="text-center py-12 text-gray-400">
                    <i class="fas fa-shopping-cart text-6xl mb-4"></i>
                    <p class="text-lg">Your cart is empty</p>
                    </div>
                </div>
                
            <div id="cart-footer" class="hidden border-t border-gray-200 p-6 space-y-4">
                <div class="flex justify-between items-center text-xl font-bold">
                    <span>Total:</span>
                    <span id="cart-total" class="text-primary">$0.00</span>
                        </div>
                <button onclick="openCheckout()" class="w-full px-6 py-4 bg-primary text-white rounded-full hover:bg-primaryDark transition-colors font-medium text-lg shadow-lg">
                    Proceed to Checkout
                    <i class="fas fa-arrow-right ml-2"></i>
                </button>
                        </div>
                    </div>
                </div>
                
    <!-- Cart Overlay -->
    <div id="cart-overlay" class="hidden fixed inset-0 bg-black/50 z-40" onclick="closeCart()"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDzitihiLQetctKmv2-VLTvbZfftB3zOmw",
            authDomain: "okinawa-e5948.firebaseapp.com",
            projectId: "okinawa-e5948",
            storageBucket: "okinawa-e5948.firebasestorage.app",
            messagingSenderId: "1079558060579",
            appId: "1:1079558060579:web:93b7cc521ec819205bcf96",
            measurementId: "G-9GLB5N0GS2"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let allProducts = [];
        let filteredProducts = [];
        let cart = JSON.parse(localStorage.getItem('okinawa-cart')) || [];
        let isEnglish = true;

        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const productType = urlParams.get('type') || 'all';

        // Load products from Firestore
        async function loadProducts() {
            try {
                console.log('Loading products from Firebase...');
                const snapshot = await db.collection('products').get();
                const products = [];
                snapshot.forEach(doc => {
                    products.push({ id: doc.id, ...doc.data() });
                });
                console.log(`Loaded ${products.length} products`);
                return products;
            } catch (error) {
                console.error('Error loading products:', error);
                alert('Error loading products. Please check console for details.');
                return [];
            }
        }

        // Initialize page
        async function initializePage() {
            try {
                console.log('Initializing page...');
                const products = await loadProducts();
                console.log(`Total products received: ${products.length}`);
                const pageTitle = document.getElementById('page-title');
                
                // Filter based on URL parameter
                if (productType === 'new-arrivals') {
                    pageTitle.textContent = 'New Arrivals';
                    allProducts = products.filter(p => p.isNewArrival === true);
                } else if (productType === 'best-selling') {
                    pageTitle.textContent = 'Best Selling';
                    allProducts = products.filter(p => p.isBestSeller === true);
                } else if (productType === 'food-beverage') {
                    pageTitle.textContent = 'Food & Beverage';
                    allProducts = products.filter(p => ['food-beverage', 'togarashi-furikake', 'miso', 'yuzu', 'matcha'].includes(p.category));
                    document.getElementById('category-filter').value = 'food-beverage';
                } else if (productType === 'beauty') {
                    pageTitle.textContent = 'Beauty';
                    allProducts = products.filter(p => ['beauty', 'body-soap', 'hand-cream', 'face-mask', 'facial-tissue'].includes(p.category));
                    document.getElementById('category-filter').value = 'beauty';
                } else if (productType === 'lifestyle') {
                    pageTitle.textContent = 'Lifestyle';
                    allProducts = products.filter(p => ['lifestyle', 'chopsticks-holders', 'matcha-set', 'bag-hanger', 'rice-soup-spoon', 'sushi-set', 'keychain', 'anime-drawing-book'].includes(p.category));
                    document.getElementById('category-filter').value = 'lifestyle';
                } else {
                    pageTitle.textContent = 'All Products';
                    allProducts = products;
                }
                
                console.log(`Filtered products: ${allProducts.length}`);
                filterProducts();
                updateCartUI();
                
            } catch (error) {
                console.error('Error initializing page:', error);
                document.getElementById('products-count').textContent = 'Error loading products. Check console.';
                alert('Error initializing page: ' + error.message);
            }
        }

        // Filter products
        function filterProducts() {
            const searchTerm = document.getElementById('product-search').value.toLowerCase();
            const categoryFilter = document.getElementById('category-filter').value;
            const sortBy = document.getElementById('sort-by').value;
            
            filteredProducts = [...allProducts];
            
            // Search filter
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(searchTerm)
                );
            }
            
            // Category filter
            if (categoryFilter !== 'all') {
                if (categoryFilter === 'food-beverage') {
                    filteredProducts = filteredProducts.filter(p => 
                        ['food-beverage', 'togarashi-furikake', 'miso', 'yuzu', 'matcha'].includes(p.category)
                    );
                } else if (categoryFilter === 'beauty') {
                    filteredProducts = filteredProducts.filter(p => 
                        ['beauty', 'body-soap', 'hand-cream', 'face-mask', 'facial-tissue'].includes(p.category)
                    );
                } else if (categoryFilter === 'lifestyle') {
                    filteredProducts = filteredProducts.filter(p => 
                        ['lifestyle', 'chopsticks-holders', 'matcha-set', 'bag-hanger', 'rice-soup-spoon', 'sushi-set', 'keychain', 'anime-drawing-book'].includes(p.category)
                    );
                } else {
                    filteredProducts = filteredProducts.filter(p => p.category === categoryFilter);
                }
            }
            
            // Sorting
            switch (sortBy) {
                case 'name':
                    filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'name-desc':
                    filteredProducts.sort((a, b) => b.name.localeCompare(a.name));
                    break;
                case 'price':
                    filteredProducts.sort((a, b) => (a.sellPrice || a.price || 0) - (b.sellPrice || b.price || 0));
                    break;
                case 'price-desc':
                    filteredProducts.sort((a, b) => (b.sellPrice || b.price || 0) - (a.sellPrice || a.price || 0));
                    break;
                case 'newest':
                    filteredProducts.sort((a, b) => {
                        const dateA = a.createdAt ? a.createdAt.toDate() : new Date(0);
                        const dateB = b.createdAt ? b.createdAt.toDate() : new Date(0);
                        return dateB - dateA;
                    });
                    break;
            }
            
            displayProducts();
        }

        // Display products
        function displayProducts() {
            const container = document.getElementById('products-grid');
            const countElement = document.getElementById('products-count');
            
            countElement.textContent = `Showing ${filteredProducts.length} product${filteredProducts.length !== 1 ? 's' : ''}`;
            
            if (filteredProducts.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-6xl mb-4">üîç</div>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">No products found</h3>
                        <p class="text-gray-500">Try adjusting your search or filter criteria</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredProducts.map(product => {
                const price = product.sellPrice || product.price || 0;
                return `
                    <div class="product-card bg-white rounded-2xl shadow-lg overflow-hidden group cursor-pointer hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2" onclick="navigateToProduct('${product.id}')">
                        <div class="relative aspect-square bg-gray-100 overflow-hidden">
                            <img src="${product.image || 'https://via.placeholder.com/300'}" 
                                 alt="${product.name}" 
                                 class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                                 onerror="this.src='https://via.placeholder.com/300?text=${encodeURIComponent(product.name)}'">
                            ${product.isNewArrival ? '<div class="absolute top-2 left-2 bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold">NEW</div>' : ''}
                            ${product.isBestSeller ? '<div class="absolute top-2 right-2 bg-yellow-500 text-white px-3 py-1 rounded-full text-xs font-bold">BEST</div>' : ''}
                    </div>
                        <div class="p-4 space-y-3">
                            <h3 class="font-semibold text-gray-900 text-lg line-clamp-2">${product.name}</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-2xl font-bold text-primary">$${price.toFixed(2)}</span>
                                <button 
                                    onclick="event.stopPropagation(); addToCart('${product.id}', '${product.name.replace(/'/g, "\\'")}', ${price}, '${product.image}')" 
                                    class="px-4 py-2 bg-primary text-white rounded-full hover:bg-primaryDark transition-colors flex items-center gap-2">
                                    <i class="fas fa-cart-plus"></i>
                                    <span>Add</span>
                    </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Cart functions
        function addToCart(productId, productName, productPrice, productImage) {
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: productName,
                    price: parseFloat(productPrice),
                    image: productImage,
                    quantity: 1
                });
            }
            
            localStorage.setItem('okinawa-cart', JSON.stringify(cart));
            updateCartUI();
            showToast('Added to cart!');
        }

        function removeFromCart(productId) {
                cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('okinawa-cart', JSON.stringify(cart));
            updateCartUI();
            updateCartDisplay();
        }

        function updateCartQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
            } else {
            localStorage.setItem('okinawa-cart', JSON.stringify(cart));
            updateCartUI();
                    updateCartDisplay();
                }
            }
        }

        function updateCartUI() {
            const cartCount = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = cartCount;
            document.getElementById('fab-cart-count').textContent = cartCount;
        }

        function updateCartDisplay() {
            const cartItems = document.getElementById('cart-items');
            const cartFooter = document.getElementById('cart-footer');
            const cartTotal = document.getElementById('cart-total');
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="text-center py-12 text-gray-400">
                        <i class="fas fa-shopping-cart text-6xl mb-4"></i>
                        <p class="text-lg">Your cart is empty</p>
                    </div>
                `;
                cartFooter.classList.add('hidden');
            } else {
                let total = 0;
                cartItems.innerHTML = cart.map(item => {
                    total += item.price * item.quantity;
                    return `
                        <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg mb-4">
                            <img src="${item.image || 'https://via.placeholder.com/60'}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg">
                            <div class="flex-1">
                                <h3 class="font-medium text-gray-900">${item.name}</h3>
                                <p class="text-sm text-primary font-semibold">$${item.price.toFixed(2)}</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="updateCartQuantity('${item.id}', -1)" class="w-8 h-8 bg-gray-200 hover:bg-gray-300 rounded-full flex items-center justify-center transition-colors">
                                    <i class="fas fa-minus text-xs"></i>
                                </button>
                                <span class="w-8 text-center font-medium">${item.quantity}</span>
                                <button onclick="updateCartQuantity('${item.id}', 1)" class="w-8 h-8 bg-primary hover:bg-primaryDark text-white rounded-full flex items-center justify-center transition-colors">
                                    <i class="fas fa-plus text-xs"></i>
                                </button>
                            </div>
                            <button onclick="removeFromCart('${item.id}')" class="text-red-500 hover:text-red-600 transition-colors">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                }).join('');
                
                cartTotal.textContent = `$${total.toFixed(2)}`;
                cartFooter.classList.remove('hidden');
            }
        }

        function openCart() {
            document.getElementById('cart-sidebar').classList.remove('translate-x-full');
            document.getElementById('cart-overlay').classList.remove('hidden');
            updateCartDisplay();
        }

        function closeCart() {
            document.getElementById('cart-sidebar').classList.add('translate-x-full');
            document.getElementById('cart-overlay').classList.add('hidden');
        }

        function openCheckout() {
            window.location.href = 'index.html#cart';
        }

        // Category overlay functions
        function toggleCategoryOverlay() {
            document.getElementById('category-overlay').classList.toggle('hidden');
        }
        
        function closeCategoryOverlay() {
            document.getElementById('category-overlay').classList.add('hidden');
        }
        
        async function selectCategoryAndClose(category) {
            closeCategoryOverlay();
            
            if (category === 'all-products') {
                    const products = await loadProducts();
                    allProducts = products;
                    document.getElementById('page-title').textContent = 'All Products';
                    document.getElementById('category-filter').value = 'all';
                    filterProducts();
                    return;
            }
            
            document.getElementById('category-filter').value = category;
            filterProducts();
        }

        // Language toggle
        function toggleLanguage() {
            isEnglish = !isEnglish;
            document.querySelector('.lang-text').textContent = isEnglish ? 'EN' : 'AR';
            document.documentElement.dir = isEnglish ? 'ltr' : 'rtl';
            localStorage.setItem('okinawa-language', isEnglish ? 'en' : 'ar');
        }

        // Navigation
        function navigateToProduct(productId) {
            window.location.href = `product.html?id=${productId}`;
        }

        // Toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-24 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-up';
            toast.innerHTML = `<i class="fas fa-check-circle mr-2"></i>${message}`;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Auth state handler
        auth.onAuthStateChanged(function(user) {
            const authButtons = document.getElementById('auth-buttons');
            const userInfo = document.getElementById('user-info');
            
            if (user) {
                // User is logged in
                if (authButtons) authButtons.style.display = 'none';
                if (userInfo) userInfo.style.display = 'flex';
                const userName = user.displayName || user.email.split('@')[0];
                const userNameEl = document.getElementById('user-name');
                if (userNameEl) userNameEl.textContent = userName;
            } else {
                // User is logged out
                if (authButtons) authButtons.style.display = 'flex';
                if (userInfo) userInfo.style.display = 'none';
            }
        });

        // Logout function
        async function logout() {
            try {
                await auth.signOut();
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            updateCartUI();
            
            // Load language preference
            const savedLang = localStorage.getItem('okinawa-language');
            if (savedLang === 'ar') {
                isEnglish = false;
                document.querySelector('.lang-text').textContent = 'AR';
                document.documentElement.dir = 'rtl';
            }
        });
    </script>
</body>
</html>

